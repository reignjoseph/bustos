<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/signup.css">
    <link rel="stylesheet" href="/static/css/registration_form.css">
    <!-- Bootstrap and custom JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="/static/js/script.js" defer=""></script>
    <title>Home</title>
    <link rel="icon" href="static/images/favicon.ico" type="image/x-icon">
    <style>
    </style>
</head>
<body>
    <header style="padding: 10px;">
        <div class="container" style="max-width: -webkit-fill-available;">
            <div class="d-flex justify-content-between align-items-center py-2">
                <a href="/" class="logo-box">
                    <img src="/static/images/jobahanap.png" style="max-width: 200px;" alt="Logo">
                </a>
                <button class="menu-icon btn btn-primary d-md-none" onclick="toggleMenu()">â˜°</button>
                <div class="boxes-container close" id="boxes-container">
                    <a href="/" class="box">
                        <img class="image" src="/static/images/home.png" alt="Logo">
                        Home</a>
                    <a href="/announcement" class="box">
                        <img class="image" src="/static/images/announcement.png" alt="Logo">
                        Announcement</a>
                    <a href="/about#" class="box">
                        <img class="image" src="/static/images/aboutus.png" alt="Logo">
                        About Us</a>
                    <a href="/about#contact" class="box">
                        <img class="image" src="/static/images/contactus.png" alt="Logo">
                        Contact Us</a>
                    <a href="/signin" class="box">
                        <img class="image" src="/static/images/signin.png" alt="Logo">
                        Sign In</a>
                </div>
            </div>
        </div>
    </header>
    <main>
        <form id="signupForm" class="signup-form" action="/create_account" method="POST">
        <div class="signup-container">
            <h2>Sign Up As</h2>

            <div id="js-error-message" class="alert alert-danger alert-dismissible fade show" role="alert" style="display: none; padding-left: 2rem; padding-right: 2rem;">
                <span id="js-error-text"></span>
                <!-- <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="right: 0px; top: -15px; width: 0; height: 0; outline:none;"> -->
                    <!-- <span aria-hidden="true">&times;</span> -->
                </button>
            </div>

            
                <div class="form-group-1 form-group-radio"> <label> <input type="radio" name="role" value="Jobseeker" checked> Jobseeker </label> <label> <input type="radio" name="role" value="Employer"> Employer </label> </div> <div class="form-group-2 abc"> <label for="name">Name:</label> <input type="text" id="name" name="name" required> </div> <div class="form-group-3 abc"> <label for="email">Email:</label> <input type="email" id="email" name="email" required> </div> <div class="form-group-4 abc password-group"> <label for="password">Password:</label> <input type="password" id="password" name="password" required> <span class="toggle-password" onclick="togglePasswordVisibility()"> <img class="eye" src="/static/images/eye-open.png" alt="Toggle Password"> </span> </div> <div class="form-group-5"> <label> <input type="checkbox" name="terms" required> I agree to the <a href="#">Terms of Service</a> </label> </div>
                <div class="form-group-6">
                    <button type="button" onclick="displayDetails()" class="btn-signup">Additional Details</button>
                </div> 
                <div class="modal fade" id="registrationModal" tabindex="-1" role="dialog" aria-labelledby="registrationModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="registrationModalLabel">Additional Registration Details</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                {% include 'menu/registration_form.html' %}
                            </div>
                            <div class="modal-footer">
                                <button style="width: 20%;" type="button" onclick="validateAndSubmit()" id="generate-pdf" class="btn-signup">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>

            <div class="signin-link">
                Have an already Account? <a href="/signin">Click Sign In</a>
            </div>
        </div>
    </form>
</main>



<!-- <script>
    document.getElementById('generate-pdf').addEventListener('click', () => {
        const element = document.querySelector('.form-container_registration'); // Adjust the selector to your form container class or ID
        html2pdf().from(element).save('form-content.pdf');
    });
    </script> -->








<script>
function displayDetails() {
    var name = document.getElementById("name").value.trim();
    var email = document.getElementById("email").value.trim();
    var password = document.getElementById("password").value.trim();
    var terms = document.querySelector('input[name="terms"]').checked;
    var errorMessageDiv = document.getElementById("js-error-message");
    var errorMessageText = document.getElementById("js-error-text");

    // Check if all required fields are filled
    if (name === "" || email === "" || password === "" || !terms) {
        errorMessageDiv.style.display = "block";
        errorMessageText.innerHTML = "Please complete all required fields.";
    } else {
        // Hide the error message div if validation passes
        errorMessageDiv.style.display = "none";

        // Perform the AJAX call to check email
        $.ajax({
            url: "/check_email",
            method: "POST",
            data: { email: email },
            success: function(response) {
                if (response.email_exists) {
                    errorMessageDiv.style.display = "block";
                    errorMessageText.innerHTML = "Email is already registered.";
                } else {
                    // Email is not registered, show additional details section
                    $('#registrationModal').modal('show');
                }
            },
            error: function() {
                errorMessageDiv.style.display = "block";
                errorMessageText.innerHTML = "An error occurred. Please try again.";
            }
        });
    }
}

</script>

<script>
    function togglePasswordVisibility() {
        var passwordField = document.getElementById("password");
        var eyeIcon = document.querySelector(".eye");

        if (passwordField.type === "password") {
            passwordField.type = "text";
            eyeIcon.src = "/static/images/eye-close.png";
        } else {
            passwordField.type = "password";
            eyeIcon.src = "/static/images/eye-open.png";
        }
    }

    function validateAndSubmit() {
        var form = document.getElementById("signupForm");
        var email = form.querySelector("input[name='email']").value; // Adjust selector if needed

        // Perform AJAX request to check email
        $.ajax({
            url: "/check_email",
            method: "POST",
            data: { email: email },
            success: function(response) {
                if (response.email_exists) {
                    alert("Email is already registered. Please use a different email.");
                } else {
                    // Proceed with form submission if email does not exist
                    if (form.checkValidity()) {
                        // Generate and upload PDF
                        generateAndUploadPDF().then(() => {
                            form.submit(); // Submit the form only after PDF operations are complete
                        });
                    } else {
                        form.reportValidity();
                    }
                }
            },
            error: function() {
                alert("An error occurred while checking the email.");
            }
        });
    }

    function generateAndUploadPDF() {
    return new Promise((resolve, reject) => {
        const element = document.querySelector('.form-container_registration'); // Adjust the selector to your form container class or ID

        html2pdf().from(element).output('blob').then(blob => {
            if (!blob.size) {
                alert('No content to generate PDF.');
                return reject(); // Reject the promise if no content is available
            }

            // Save PDF locally
            // html2pdf().from(element).save('form-content.pdf');

            // Upload PDF to server
            const formData = new FormData();
            formData.append('pdf', blob, 'form-content.pdf');

            fetch('/insert_html2pdf_jobseeker', {
                method: 'POST',
                body: formData
            }).then(response => {
                if (response.ok) {
                    // alert('PDF uploaded successfully!');
                    resolve(); // Resolve the promise to indicate completion
                } else {
                    alert('Failed to upload PDF.');
                    reject(); // Reject the promise if upload fails
                }
            }).catch(() => {
                alert('An error occurred while uploading the PDF.');
                reject(); // Reject the promise if an error occurs
            });
        }).catch(() => {
            alert('An error occurred while generating the PDF.');
            reject(); // Reject the promise if PDF generation fails
        });
    });
}



</script>

</body>
</html>
